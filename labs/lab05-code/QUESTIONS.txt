                           __________________

                            LAB 05 QUESTIONS
                           __________________


- Name: Warren Weber
- NetID: Weber767

Answer the questions below according to the lab specification. Write
your answers directly in this text file and submit it to complete Lab01.


PROBLEM 1 `dirops.c'
====================

A
~

  Examine the source code of `dirops.c' closely. It makes use of a
  variety of system calls to produce a semi-interesting effect.  Compile
  and run it several times. Describe the overall intent of the program
  based on its output and the code you understand.

  'dirops.c' searches through the directory, pointed to by dir, and finds the
  largest file, in bytes, and sets max_size and max_name to that files Name
  and size. After 'dirops.c' has found the max size file it makes a copy of that
  file with read and write permissions set for only the user.


B
~

  What set of system calls is used by the program to determine all the
  files in the current directory? Describe briefly how these calls work
  together.

  opendir(): opens a directory stream for the directory that corresponds to
  the string name passed.

  readdir(): returns a pointer to the next directory entry in the directory
  pointed to by the passed DIR pointer. Returns NULL when there are no more
  entries to read.

  opendir() returns a DIR pointer for the directory that you want to access.
  That pointer is passed to readdir(), which then stores every entry in that dir
  into a dirent struct which can be used to read some information on that entry.


C
~

  Identify the system call that `dirops.c' uses to find the sizes of
  files. Describe briefly how this call works.

  stat() call returns a stat structure that contains information about the file
  passed to it, a file pointer, as the first argument.


D
~

  The following line sets up the read/write permissions that the copied
  file will have.
  ,----
  | mode_t perms = S_IRUSR | S_IWUSR;
  `----
  Modify this line so that the copied file is readable by the group as
  well as the user.
  ,----
  | mode_t perms = S_IRUSR | S_IWUSR |S_IRWXG;
  `----
  /Optional challenge:/ Set the permissions to be identical to the
  original file. `stat()' is one way to find out the permissions for the
  original file.
  ,----
  | struct stat sb;
  | stat(max_name, &sb);
  | mode_t perms = sb.st_mode;
  `----
E
~

  `dirops.c' contains a subtle bug in the following bit of code towards
  the end of the file.
  ,----
  |   while( (nbytes = read(infd, buf, BUFSIZE)) > 0){
  |     write(outfd, buf, BUFSIZE);
  |   }
  `----
  You should observe that every time program is run, it will identify a
  copied file as the largest and make another copy due to this bug. It
  may help to examine the ends of the copied files with the `tail
  file.txt.copy' command which will show the last 10 lines.

  Explain what is wrong with the loop and paste a fixed version below.

  Read fails to read in the entire BUFSIZE amount of bytes from infd into
  buf on the final call, so when write is called and assigned to read BUFSIZE
  amount of bytes from buf into outfd it reads what ever bytes were not
  overwritten in buf by the final read call.
  ,----
  |   while( (nbytes = read(infd, buf, BUFSIZE)) > 0){
  |    write(outfd, buf, nbytes);
  |   }
  `----
